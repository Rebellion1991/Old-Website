{{- if (eq .Site.Params.theme.defaultTheme "light") }}
<script>
    if (document.body.className.includes("dark")) {
        document.body.classList.remove('dark');
        localStorage.setItem("pref-theme", 'light');
    }
</script>

{{ else if (eq .Site.Params.theme.defaultTheme "dark") }}
{{- /* theme is dark */}}
<script>
    if (document.body.className.includes("light")) {
        document.body.classList.add('dark');
        localStorage.setItem("pref-theme", 'dark');
    }
</script>

{{- else }}
{{- /* theme is auto */}}
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
{{- end }}

{{- if (not .Site.Params.theme.disableThemeToggle) }}
<script>
    // Initialize theme toggle state
    const themeToggle = document.getElementById("theme-toggle");
    
    // Function to toggle theme
    function toggleTheme() {
        const isDarkMode = document.body.className.includes("dark");
        
        if (isDarkMode) {
            // Switch to light mode
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
            themeToggle.setAttribute("aria-checked", "false");
            // Announce theme change to screen readers
            themeToggle.setAttribute("aria-label", "Dark mode disabled, toggle to enable dark mode");
            // Add visual feedback
            themeToggle.classList.remove('dark-mode');
            themeToggle.classList.add('light-mode');
        } else {
            // Switch to dark mode
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
            themeToggle.setAttribute("aria-checked", "true");
            // Announce theme change to screen readers
            themeToggle.setAttribute("aria-label", "Dark mode enabled, toggle to enable light mode");
            // Add visual feedback
            themeToggle.classList.remove('light-mode');
            themeToggle.classList.add('dark-mode');
        }
        
        // Announce the change to screen readers
        const announcement = document.createElement('div');
        announcement.setAttribute('aria-live', 'polite');
        announcement.classList.add('visually-hidden');
        announcement.textContent = isDarkMode ? 'Switched to light mode' : 'Switched to dark mode';
        document.body.appendChild(announcement);
        
        // Remove the announcement after it's been read
        setTimeout(() => {
            document.body.removeChild(announcement);
        }, 1000);
    }
    
    // Set initial aria-checked state and visual class based on current theme
    if (document.body.className.includes("dark")) {
        themeToggle.setAttribute("aria-checked", "true");
        themeToggle.classList.add('dark-mode');
    } else {
        themeToggle.setAttribute("aria-checked", "false");
        themeToggle.classList.add('light-mode');
    }
    
    // Add click handler
    themeToggle.addEventListener("click", toggleTheme);
    
    // Add keyboard handler for accessibility
    themeToggle.addEventListener("keydown", (e) => {
        // Toggle on Enter or Space key
        if (e.key === "Enter" || e.key === " " || e.key === "Spacebar") {
            e.preventDefault();
            toggleTheme();
        }
    })

    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    })

</script>
{{- end }}

{{ if not (.Site.Params.navbar.disableSearch | default false) }}
    <script src="{{ .Site.Params.staticPath }}/js/search.js"></script>
{{ end }}


{{ if (.Params.mathjax | default false) }}

{{ "<!-- MathJax -->" | safeHTML }}
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js" integrity="sha384-M5jmNxKC9EVnuqeMwRHvFuYUE8Hhp0TgBruj/GZRkYtiMrCRgH7yvv5KY+Owi7TW" crossorigin="anonymous"></script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['\\(','\\)']],
        displayMath: [['$$','$$'], ['\[','\]']],
        processEscapes: true,
        processEnvironments: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
        TeX: { equationNumbers: { autoNumber: "AMS" },
             extensions: ["AMSmath.js", "AMSsymbols.js"] }
      }
    });
</script>
{{ end }}

{{ if (.Site.Params.cloudinary_cloud_name | default false) }}

{{ "<!-- cloudinary -->" | safeHTML }}
<script src="https://unpkg.com/cloudinary-core@2.13.0/cloudinary-core-shrinkwrap.js" integrity="sha384-0bQduxVhZMs6xfvcPH9osdUIw44hjF8EahHuQBdyN6Rryk8tgyFO80Yz5d14F+5d" crossorigin="anonymous"></script>
<script type="text/javascript">
    var cl = cloudinary.Cloudinary.new({cloud_name: "{{- .Site.Params.cloudinary_cloud_name }}"}); 
    cl.responsive();
</script>

{{ end }}

{{/* FormSpree and Contact form scripts */}}
{{ if .Site.Params.contact.formspree.enable | default false }}
    <!-- FormSpree's official JavaScript library -->
    <script src="https://formspree.io/js/formbutton-v1.min.js" defer></script>
    <!-- Our custom contact form handler -->
    <script src="{{ .Site.Params.staticPath | default "/static" }}/js/contact-form.js"></script>
{{ end }}

{{ if (.Site.Params.customScripts | default false) }}
{{ .Site.Params.customScripts | safeHTML }}
{{ end }}
